#!/bin/bash
# ==============================================================================
# 163 Gateway 服务启动脚本
# ==============================================================================

echo "[INFO] 启动 163 Gateway 服务..."

# 设置环境变量
export PYTHONUNBUFFERED=1
export PYTHONPATH=/app

# 等待 Home Assistant 核心启动完成
echo "[INFO] 等待 Home Assistant 核心启动完成..."
sleep 15

# 切换到应用目录
cd /app

# 检查 Python 环境
echo "[INFO] 检查 Python 环境..."
python3 --version
pip3 list | grep -E "(requests|paho-mqtt)"

# 确保数据目录存在且有权限
mkdir -p /data
chmod 755 /data

echo "[INFO] 启动主程序..."
# 使用 exec 确保信号正确传递
exec python3 main.py
